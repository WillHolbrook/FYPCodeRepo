<VirtualHost *:80>

    ServerName www.willholbrook.com
    ServerAlias willholbrook.com
    ServerAdmin will@willholbrook.com

    DirectoryIndex index.html
    DocumentRoot /usr/local/www/frontend/documents

    Alias /robots.txt /usr/local/www/frontend/documents/robots.txt
    Alias /favicon.ico /usr/local/www/frontend/documents/favicon.ico

    Alias /static/ /usr/local/www/frontend/documents/static/

    <Directory /usr/local/www/frontend/documents>
        <IfVersion < 2.4>
            Order allow,deny
            Allow from all
        </IfVersion>
        <IfVersion >= 2.4>
            Require all granted
        </IfVersion>

        RewriteEngine On
        # Don't rewrite files or directories
        RewriteCond %{REQUEST_FILENAME} -f [OR]
        RewriteCond %{REQUEST_FILENAME} -d
        RewriteRule ^ - [L]
        # Rewrite everything else to index.html to allow html5 state links
        RewriteCond %{REQUEST_URI} !^/api/
        RewriteCond %{REQUEST_URI} !^/admin/
        RewriteCond %{REQUEST_URI} !^/auth/
        RewriteRule ^ index.html [L]
    </Directory>

    <Location /api/>
        ProxyPass        http://localhost:4030/api/
        ProxyPassReverse http://localhost:4030/api/
    </Location>

    <Location /admin/>
        ProxyPass        http://localhost:4030/admin/
        ProxyPassReverse http://localhost:4030/admin/
    </Location>

    <Location /auth/>
        ProxyPass        http://localhost:4030/auth/
        ProxyPassReverse http://localhost:4030/auth/
    </Location>

    <Location /media/>
        ProxyPass        http://localhost:4030/media/
        ProxyPassReverse http://localhost:4030/media/
    </Location>
</VirtualHost>
